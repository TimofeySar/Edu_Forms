<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EduForms{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="{{ 'dark-theme' if theme == 'dark' else 'light-theme' }}">
    {% include 'navbar.html' %}
    <div class="container my-4">
        {% block content %}{% endblock %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Функция для сохранения темы в localStorage
        function saveThemeToLocalStorage(theme) {
            localStorage.setItem('theme', theme);
        }

        // Функция для получения темы из localStorage
        function getThemeFromLocalStorage() {
            return localStorage.getItem('theme') || 'light'; // По умолчанию 'light'
        }

        // Функция для применения темы
        function applyTheme(theme) {
            document.body.classList.remove('dark-theme', 'light-theme');
            document.body.classList.add(theme === 'dark' ? 'dark-theme' : 'light-theme');
        }

        // Восстановление темы при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = getThemeFromLocalStorage();
            applyTheme(savedTheme);

            // Синхронизация темы с сервером
            fetch('/toggle_theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ theme: savedTheme }),
            });
        });

        // Обработчик для кнопки смены темы
        document.querySelector('.theme-toggle-button').addEventListener('click', function() {
            const currentTheme = getThemeFromLocalStorage();
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            // Сохраняем новую тему в localStorage
            saveThemeToLocalStorage(newTheme);

            // Применяем новую тему
            applyTheme(newTheme);

            // Синхронизация с сервером
            fetch('/toggle_theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ theme: newTheme }),
            });
        });
    </script>
</body>
</html>